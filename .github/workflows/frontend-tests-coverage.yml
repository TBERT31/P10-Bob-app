name: Frontend tests and Karma report # Nom du Workflow affich√© dans l'interface Github Actions
run-name: ${{ github.actor }} is running frontend tests and generating Karma coverage reports üöÄ

# D√©clanche le workflow √† chaque push ou pull request sur les branches main, develop etc...
on:
  push:
      branches: [main, develop, feat/*, fix/*]
  pull_request:
      branches: [main, develop, feat/*, fix/*]
      types: [opened, synchronize, reopened]
  
# D√©finit un job nomm√© Frontend-test qui s'ex√©cute sur une machine Virtuelle Ubuntu (Version la plus r√©cente)  
jobs:
  Frontend-test:
    runs-on: ubuntu-latest

    # D√©finit `front` comme r√©pertoire de travail par d√©faut pour toutes les √©tapes du job.
    defaults:
      run:
        working-directory: front

    # Utilise une strat√©gie de matrice pour tester sur diff√©rentes versions de Node.js.
    strategy:
      matrix:
        node-version: [20.x] # Versions de Node.js √† tester

    steps:
      - name: Checkout
        uses: actions/checkout@v4 # Utilise l'action checkout pour r√©cup√©rer le code source du d√©p√¥t.

      - name: Use Node.js ${{matrix.node-version}}
        uses: actions/setup-node@v4 # Utilise l'action setup-node pour configurer Node.js
        with:
          node-version: ${{matrix.node-version}} # Utilise la version de Node.js d√©finie dans la matrice

      - name: Install dependencies
        run: npm ci # Installe les d√©pendances npm (npm install marche aussi)

      - name: Run npm test
        run: npm run test:prod # Ex√©cute les tests sans watcher et en calculant la couverture

      - name: Build application
        run: npm run build # Ex√©cute les tests sans watcher et en calculant la couverture
      
      - name: Upload coverage report
        uses: actions/upload-artifact@v4 # Utilise l'action upload-artifact pour t√©l√©charger les fichiers de rapport de couverture g√©n√©r√©s par Karma.
        if: success() || failure()
        with:
          name: karma-report
          path: front/coverage # Chemin vers les fichiers de rapport de couverture